<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> I downloaded malware! Now what? | Jeano Ermitaño </title> <meta name="author" content="Jeano Ermitaño"> <meta name="description" content="Enabling active detection and response capabilities in Wazuh with VirusTotal"> <meta name="keywords" content="cybersecurity, blog, jeano, ermitano, portfolio, job"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico?95585469405a71c7d169c1e0e45e06f5"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jeanoskii.github.io/blog/2026/wazuh-virustotal/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Jeano</span> Ermitaño </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">I downloaded malware! Now what?</h1> <p class="post-meta"> Created on January 13, 2026 </p> <p class="post-tags"> <a href="/blog/2026"> <i class="fa-solid fa-calendar fa-sm"></i> 2026 </a>   ·   <a href="/blog/tag/wazuh"> <i class="fa-solid fa-hashtag fa-sm"></i> wazuh</a>   <a href="/blog/tag/virustotal"> <i class="fa-solid fa-hashtag fa-sm"></i> virustotal</a>   <a href="/blog/tag/malware"> <i class="fa-solid fa-hashtag fa-sm"></i> malware</a>   <a href="/blog/tag/xdr"> <i class="fa-solid fa-hashtag fa-sm"></i> xdr</a>   <a href="/blog/tag/edr"> <i class="fa-solid fa-hashtag fa-sm"></i> edr</a>   ·   <a href="/blog/category/cybersecurity"> <i class="fa-solid fa-tag fa-sm"></i> cybersecurity</a>   <a href="/blog/category/software"> <i class="fa-solid fa-tag fa-sm"></i> software</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>In my <a href="/wazuh-install">previous</a> blog post, I alluded to Wazuh being both a SIEM and an XDR. I specifically mentioned that VirusTotal can be integrated into Wazuh for file integrity monitoring. Today, we’ll be discussing how I enabled VirusTotal integration in Wazuh.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/2026-01-14/VirusTotal-480.webp 480w,/assets/img/posts/2026-01-14/VirusTotal-800.webp 800w,/assets/img/posts/2026-01-14/VirusTotal-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/posts/2026-01-14/VirusTotal.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>But what’s <a href="https://www.virustotal.com/" rel="external nofollow noopener" target="_blank">VirusTotal</a>? It is a free online service that analyzes files, URLs, IP addresses, and domains for malware. VirusTotal works with antivirus scanners and URL/domain blocklisting services to intelligently inspect anything you upload to its web interface. In addition, when a user scans an object, the results are aggregated in a global repository, thereby making a contribution to worldwide cybersecurity efforts. This is an extremely useful tool for any cybersecurity professional!</p> <p>Now that you know how important VirusTotal is, let’s get to configuring it! But let us recall first our infrastructure:</p> <pre><code class="language-mermaid">flowchart LR
    subgraph "Windows Desktop"
        A[Wazuh Agent]
        subgraph "VirtualBox"
            subgraph "Ubuntu Virtual Machine"
                B[Wazuh Server]
            end
            subgraph "Ubuntu Virtual Machine"
                C[Wazuh Agent]
            end
        end
    end
    subgraph "Windows Laptop"
        D[Wazuh Agent]
    end
    B --&gt;|Monitors| A
    B --&gt;|Monitors| C
    B --&gt;|Monitors| D
</code></pre> <p>As you can see, we have two physical machines running Windows, and two Ubuntu virtual machines. Our Wazuh server is installed in one of the Ubuntu VMs, while the rest have Wazuh agents (a.k.a. endpoints).</p> <p>I followed Wazuh’s <a href="https://documentation.wazuh.com/current/proof-of-concept-guide/detect-remove-malware-virustotal.html" rel="external nofollow noopener" target="_blank">Proof of Concept guide</a> for detecting and removing malware using VirusTotal integration. In this guide, three files will be referenced multiple times:</p> <ul> <li>ossec.conf</li> <li>local_rules.xml</li> <li>remove-threat.sh / remove-threat.exe</li> </ul> <p>Depending on the operating system, the <code class="language-plaintext highlighter-rouge">ossec.conf</code> file can be found in <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\ossec-agent\</code> for Windows; and under Ubuntu it can be found in <code class="language-plaintext highlighter-rouge">/var/ossec/etc/</code>. We will be modifying the configuration file for both the Wazuh server and the Wazuh agents. Whereas the <code class="language-plaintext highlighter-rouge">local_rules.xml</code> will be modified on the Wazuh server only, which can be found in <code class="language-plaintext highlighter-rouge">/var/ossec/etc/rules</code> directory. Lastly, the <code class="language-plaintext highlighter-rouge">remove-threat</code> file is the active response script provided by Wazuh, so we don’t need to write it ourselves. We are free to modify the script to fit our environment, but for this home lab, it works out of the box.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/2026-01-14/wazuh-osseconf-ubuntu.PNG" sizes="95vw"></source> <img src="/assets/img/posts/2026-01-14/wazuh-osseconf-ubuntu.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/2026-01-14/wazuh-localrules.PNG" sizes="95vw"></source> <img src="/assets/img/posts/2026-01-14/wazuh-localrules.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/2026-01-14/wazuh-removethreat-windows.PNG" sizes="95vw"></source> <img src="/assets/img/posts/2026-01-14/wazuh-removethreat-windows.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>We must also be familiar with the software we will be using, primarily, the use terminal and Powershell commands. I exclusively used the command-line interface to set up the VirusTotal integration, except for in Windows where I had to open Notepad to edit text files and and install Python using the installer GUI.</p> <p>After becoming familiar with the files and tools needed, we can proceed to follow the guide. I first set up the endpoints, both Ubuntu and Windows. Afterwards, I configured the Wazuh server on the Ubuntu VM. Then, I downloaded an EICAR file on both agents. What’s an <a href="https://www.eicar.org/download-anti-malware-testfile/" rel="external nofollow noopener" target="_blank">EICAR file</a> you ask? An EICAR file is used to test the detection capability of an antivirus software. Once I downloaded the EICAR files, hits began showing up on the dashboard.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/2026-01-14/wazuh-virustotal-hit.PNG" sizes="95vw"></source> <img src="/assets/img/posts/2026-01-14/wazuh-virustotal-hit.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>As you can see, Wazuh was able to detect that the EICAR file was added on the endpoint. That’s when VirusTotal kicks in. Wazuh integrates VirusTotal for File Integrity Monitoring (FIM), meaning, the EICAR file will be sent to VirusTotal for scanning. A VirusTotal alert gets outputted, therefore flagging the file as malicious.</p> <p>The title of this blog post is “I downloaded malware! Now what?” The answer is: Wazuh <strong>deletes</strong> the malicious file. Automatically! Without user intervention! That’s the beauty of active response. With a SIEM like Wazuh, we can integrate detection and response functionalities, allowing seamless removal of files on the endpoints while flagging an alert in the server. This is why Wazuh is both a SIEM and an XDR.</p> <p>With that, we have successfully configured VirusTotal, simulated an attack, and visualized an alert in Wazuh. This splendid software has more to offer though, so we might be seeing each other again soon.</p> <p>Until next time!</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/tutorials/">Watch me on Youtube</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/wazuh-install/">What SIEMs to be the problem?</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/first/">Hello, world!</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Jeano Ermitaño. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/mermaid@10.7.0/dist/mermaid.min.js" integrity="sha256-TtLOdUA8mstPoO6sGvHIGx2ceXrrX4KgIItO06XOn8A=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/d3@7.8.5/dist/d3.min.js" integrity="sha256-1rA678n2xEx7x4cTZ5x4wpUCj6kUMZEZ5cxLSVSFWxw=" crossorigin="anonymous"></script> <script defer src="/assets/js/mermaid-setup.js?38ca0a0126f7328d2d9a46bad640931f" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?c15de51d4bb57887caa2c21988d97279"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>